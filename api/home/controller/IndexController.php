<?php
// +----------------------------------------------------------------------
// | ThinkCMF [ WE CAN DO IT MORE SIMPLE ]
// +----------------------------------------------------------------------
// | Copyright (c) 2013-2017 http://www.thinkcmf.com All rights reserved.
// +----------------------------------------------------------------------
// | Author: Dean <zxxjjforever@163.com>
// +----------------------------------------------------------------------
namespace api\home\controller;


use cmf\controller\RestBaseController;
use Phpml\Classification\NaiveBayes;
use Phpml\Classification\SVC;
use Phpml\SupportVectorMachine\Kernel;
use Phpml\ModelManager;

class IndexController extends RestBaseController
{
    // api 首页
    public function index()
    {
        $this->success("恭喜您,API访问成功!", [
            'version' => '1.1.0',
            'doc'     => 'http://www.thinkcmf.com/cmf5api.html'
        ]);
    }

    public function  demo(){
        $samples = [
            [2.2,8],
            [7.6,29],
            [5.2,19],
            [2.6,10],
            [7.4,28],
            [6.8,26],
            [6.1,23],
            [7.2,27],
            [7.1,27],
            [5.7,21],
            [6.7,25],
            [12.1,46],
            [11.4,43],
            [12.4,46],
            [14.5,55],
            [9.3,37],
            [12.1,45],
            [9.2,35],
            [14,52],
            [9.2,34],
            [7.9,30],
            [8.6,32],
            [9.7,36],
            [11.4,43],
            [13.9,52],
            [13.2,50],
            [12.4,46],
            [6.2,23],
            [8.2,31],
            [7.8,29],
            [9.2,34],
            [9.6,36],
            [6.4,24],
            [7.2,27],
            [7.5,28],
            [16.3,61],
            [12.7,48],
            [12.9,49],
            [11.5,43],
            [11.6,44],
            [17.2,65],
            [12.8,48],
            [15.4,58],
            [9.9,37],
            [18.9,71],
            [13.7,51],
            [14,53],
            [12.2,46],
            [13,49],
            [13.5,51],
            [10.5,39],
            [16.9,64],
            [14.2,53],
            [13.5,51],
            [15.2,57],
            [12.2,46],
            [14,53],
            [11.3,42],
            [14.3,54],
            [18.5,69],
            [17,64],
            [18.1,68],
            [15,56],
            [15.3,57],
            [17.4,65],
            [16.3,61],
            [15,56],
            [18.1,68],
            [16.9,63],
            [19.5,73],
            [18.8,70],
            [15,56],
            [15.6,59],
            [15.1,57],
            [18.2,68],
            [14.4,54],
            [20.6,77],
            [21.9,82],
            [19.2,72],
            [12.7,48],
            [20,75],
            [19.7,74],
            [25.4,95],
            [23.2,88],
            [24.5,93],
            [23.2,87],
            [17.6,66],
            [23.1,87],
            [26.3,99],
            [29.1,109],
            [26.8,101],
            [31.1,117],
            [26.2,98],
            [32.2,121],
            [33.5,125],
            [29.3,110],
            [31.6,119],
            [25.1,94],
            [29.1,109],
            [35.6,134],
            [29.8,112],
            [27.3,102],
            [34,128],
            [44.7,168],
            [49.3,186],
            [20,5.4],
            [19,5.1],
            [18,4.8],
            [23,6],
            [26,6.9],
            [27,7.2],
            [24,6.5],
            [23,6.2],
            [16,4.3],
            [11,3],
            [19,5.1],
            [23,6.2],
            [28,7.4],
            [32,8.5],
            [32,8.6],
            [34,9.1],
            [32,8.5],
            [31,8.4],
            [29,7.8],
            [25,6.6],
            [27,7.2],
            [27,7],
            [20,5.4],
            [34,9],
            [36,9.6],
            [31,8.2],
            [10,2.6],
            [20,5.4],
            [12,3.1],
            [15,4],
            [17,4.5],
            [23,6.2],
            [14,3.8],
            [22,5.8],
            [43,11.4],
            [26,7],
            [31,8.2],
            [35,9.3],
            [39,10.5],
            [37,9.9],
            [42,11.1],
            [39,10.3],
            [37,10],
            [37,9.9],
            [42,11.1],
            [39,10.4],
            [38,10.2],
            [36,9.5],
            [38,10.2],
            [34,9.1],
            [39,10.3],
            [35,9.4],
            [37,9.9],
            [36,9.5],
            [34,9],
            [32,8.6],
            [36,9.7],
            [25,6.7],
            [24,6.4],
            [23,6],
            [19,5.2],
            [16,4.3],
            [16,4.1],
            [12,3.2],
            [7,1.8],
            [10,2.6],
            [6,1.6],
            [9,2.5],
            [9,2.5],
            [14,3.7],
            [16,4.4],
            [22,5.8],
            [26,7.1],
            [28,7.5],
            [30,8],
            [36,9.7],
            [44,11.7],
            [38,10.2],
            [39,10.4],
            [44,11.8],
            [52,14],
            [42,11.3],
            [51,13.6],
            [71,18.9],
            [45,12.1],
            [52,13.9],
            [48,12.7],
            [51,13.5],
            [50,13.3],
            [64,17.2],
            [50,13.2],
            [44,11.7],
            [52,13.8],
            [46,12.3],
            [46,12.1],
            [36,9.5],
            [48,12.7],
            [42,11.1],
            [32,8.6],
            [36,9.6],
            [41,10.8],
            [31,8.3],
            [34,9.1],
            [25,6.5],
            [25,6.7],
            [21,5.7],
            [16,4.3],
            [23,6.2],
            [20,5.4],
            [11,3],
            [12,3.3],
            [8,2.1],
            [16,4.3],
            [17,4.6],
            [22,5.8],
            [30,7.8],
            [18,4.9],
            [17,4.6],
            [12,3.2],
            [22,5.8],
            [27,7.2],
            [27,7.2],
            [27,7.3],
            [21,5.7],
            [36,9.7],
            [30,8],
            [43,11.5],
            [49,13.1],
            [60,16],
            [55,14.6],
            [61,16.2],
            [71,19.9],
            [78,20.6],
            [74,19.7],
            [73,19.4],
            [73,19.5],
            [84,22.3],
            [76,20.2],
            [72,19.1],
            [59,15.6],
            [72,19.2],
            [78,20.9],
            [81,21.5],
            [77,20.5],
            [81,21.6],
            [57,15.2],
            [85,22.7],
            [75,19.9],
            [58,15.4],
            [63,16.8],
            [69,18.5],
            [51,13.6],
            [68,18.2],
            [69,18.3],
            [55,14.6],
            [51,13.5],
            [41,10.8],
            [64,16.9],
            [67,17.9],
            [53,14.1],
            [45,11.9],
            [47,12.5],
            [37,9.9],
            [39,10.4],
            [41,11],
            [36,9.7],
            [28,7.5],
            [22,5.9],
            [21,5.6],
            [37,9.9],
            [37,10],
            [28,7.4],
            [44,11.8],
            [54,14.3],
            [54,14.4],
            [62,16.5],
            [45,12.1],
            [55,14.7],
            [78,20.8],
            [81,21.5],
            [131,34.8],
            [93,24.8],
            [117,31.1],
            [95,25.3],
            [109,28.9],
            [78,20.7],
            [53,14.1],
            [48,12.7],
            [45,12],
            [36,9.7],
            [26,7],
            [35,9.2],
            [37,9.8],
            [36,9.5],
            [37,9.8],
            [45,12.1],
            [55,14.7],
            [81,21.6],
            [75,20],
            [76,20.4],
            [77,20.6],
            [85,22.6],
            [104,27.8],
            [119,31.6],
            [104,27.7],
            [78,20.9],
            [77,20.5],
            [64,17.2],
            [57,15.3],
            [50,13.4],
            [55,14.6],
            [60,16],
            [63,16.9],
            [75,20],
            [68,18.3],
            [68,18.1],
            [57,15.3],
            [52,13.9],
            [78,20.9],
            [91,24.4],
            [93,24.8],
            [109,29.1],
            [107,28.5],
            [125,33.5],
            [157,41.9],
            [162,43.2],
            [132,35.2],
            [131,34.9],
            [109,29],
            [68,18.1],
            [84,22.4],
            [81,21.6],
            [82,22],
            [193,50.6],
            [170,45.2],
            [134,35.6],
            [101,26.9],
            [101,26.9],
            [95,25.4],
            [79,21],
            [64,17],
            [74,19.7],
            [81,21.4],
            [109,29.1],
            [119,31.7],
            [114,30.4],
            [106,28.3],
            [188,50.1],
            [135,36],
            [130,34.5],
            [128,34.2],
            [120,31.9],
            [106,28.2],
            [87,23.1],
            [86,23],
            [117,31.1],
            [132,35.3],
            [121,32.2],
            [150,39.9],
            [154,41.1],
            [99,26.4],
            [98,26.1],
            [96,25.5],
            [110,29.3],
            [135,35.5],
            [136,36.2],
            [139,37.1],
            [142,37.6],
            [135,35.8],
            [101,26.8],
            [137,36.5],
            [162,43.3],
            [162,43.1],
            [105,27.9],
            [109,28.9],
            [99,26.4],
            [154,41.1],
            [131,34.9],
            [100,26.4],
            [90,23.9],
            [93,24.5],
            [113,30],
            [85,22.6],
            [128,34],
            [96,25.4],
            [185,49.2],
            [178,47.4],
            [73,19.4],
            [107,28.5],
            [86,22.9],
            [94,25.1],
            [116,30.8],
            [150,39.9],
            [131,34.8],
            [123,32.8],
            [118,31.3],
            [133,35.6],
            [139,37],
            [145,38.7],
            [145,38.8],
            [146,39],
            [165,43.9],
            [117,31.1],
            [132,35],
            [94,24.9],
            [188,50],
            [208,55.4],
            [222,59.2],
            [212,56.6],
            [168,44.7],
            [169,44.9],
            [212,56.6],
            [194,51.8],
            [190,50.6],
            [195,52],
            [194,51.8],
            [183,48.9],
            [11.5, 43],
            [12.1,45],
            [11.6, 44],
            [11.6, 43],
            [11.9,50]
        ];
        $labels = [
            15,
            20,
            20,
            20,
            25,
            25,
            25,
            25,
            25,
            25,
            25,
            30,
            30,
            30,
            30,
            30,
            30,
            30,
            30,
            30,
            30,
            30,
            30,
            30,
            30,
            30,
            30,
            30,
            30,
            30,
            30,
            30,
            30,
            30,
            30,
            35,
            35,
            35,
            35,
            35,
            40,
            40,
            40,
            40,
            40,
            40,
            40,
            40,
            40,
            40,
            40,
            40,
            40,
            40,
            40,
            40,
            40,
            40,
            45,
            45,
            45,
            45,
            50,
            50,
            50,
            50,
            50,
            50,
            50,
            50,
            50,
            50,
            50,
            50,
            50,
            50,
            50,
            50,
            50,
            50,
            55,
            60,
            80,
            80,
            80,
            80,
            80,
            80,
            80,
            85,
            90,
            90,
            90,
            90,
            90,
            100,
            100,
            100,
            100,
            100,
            100,
            100,
            120,
            135,
            150,
            30,
            30,
            30,
            30,
            30,
            30,
            30,
            30,
            30,
            20,
            30,
            25,
            30,
            30,
            30,
            30,
            30,
            30,
            25,
            25,
            30,
            30,
            30,
            30,
            30,
            30,
            20,
            30,
            20,
            20,
            25,
            30,
            20,
            25,
            30,
            25,
            30,
            30,
            30,
            30,
            30,
            30,
            30,
            30,
            30,
            30,
            30,
            30,
            30,
            30,
            30,
            30,
            30,
            30,
            30,
            30,
            30,
            25,
            25,
            25,
            25,
            25,
            25,
            20,
            15,
            15,
            15,
            20,
            20,
            20,
            20,
            20,
            20,
            25,
            25,
            30,
            30,
            30,
            30,
            30,
            30,
            30,
            30,
            40,
            40,
            30,
            30,
            40,
            30,
            50,
            30,
            30,
            30,
            30,
            40,
            30,
            30,
            30,
            30,
            30,
            30,
            30,
            30,
            25,
            20,
            20,
            20,
            25,
            20,
            20,
            20,
            15,
            20,
            20,
            25,
            30,
            20,
            20,
            20,
            25,
            25,
            25,
            25,
            30,
            30,
            30,
            40,
            40,
            40,
            35,
            40,
            40,
            50,
            50,
            50,
            50,
            60,
            50,
            40,
            40,
            40,
            45,
            50,
            50,
            50,
            40,
            50,
            50,
            40,
            45,
            50,
            30,
            50,
            50,
            40,
            30,
            30,
            40,
            50,
            35,
            30,
            30,
            30,
            30,
            30,
            30,
            25,
            20,
            20,
            30,
            30,
            25,
            35,
            40,
            40,
            50,
            30,
            50,
            80,
            80,
            100,
            100,
            80,
            80,
            90,
            70,
            50,
            50,
            35,
            30,
            30,
            30,
            30,
            30,
            30,
            40,
            50,
            50,
            60,
            60,
            60,
            65,
            80,
            90,
            80,
            70,
            70,
            60,
            50,
            40,
            50,
            50,
            50,
            50,
            50,
            50,
            40,
            40,
            50,
            70,
            70,
            80,
            80,
            100,
            130,
            130,
            110,
            100,
            80,
            40,
            60,
            60,
            60,
            120,
            110,
            100,
            80,
            80,
            80,
            55,
            40,
            50,
            50,
            80,
            90,
            90,
            80,
            130,
            120,
            100,
            100,
            80,
            70,
            60,
            60,
            80,
            90,
            110,
            90,
            100,
            70,
            70,
            60,
            80,
            90,
            90,
            90,
            90,
            90,
            70,
            90,
            120,
            120,
            80,
            100,
            70,
            120,
            90,
            70,
            80,
            80,
            100,
            60,
            90,
            70,
            150,
            150,
            55,
            75,
            60,
            80,
            100,
            130,
            100,
            100,
            100,
            120,
            120,
            120,
            120,
            120,
            130,
            80,
            100,
            70,
            160,
            160,
            180,
            170,
            150,
            150,
            160,
            150,
            150,
            150,
            150,
            150,
            30,
            30,
            30,
            30,
            30
        ];

        //$classifier = new NaiveBayes();
        $classifier = new SVC(Kernel::LINEAR, $cost=1.0);
        $classifier->train($samples, $labels);
        $filepath = "/home/wwwroot/huoda/model";
        $modelManager = new ModelManager();
        $modelManager->saveToFile($classifier, $filepath);
    }
    
    public function predict(){
        $filepath = "/home/wwwroot/huoda/model";
        $modelManager = new ModelManager();
        $classifier = $modelManager->restoreFromFile($filepath);
        var_dump($classifier->predict([5.4, 20]));
        var_dump($classifier->predict([6.6, 25]));
        var_dump($classifier->predict([6.5, 25]));
        var_dump($classifier->predict([13.9, 52]));
        var_dump($classifier->predict([20.9, 78]));
        var_dump($classifier->predict([11.4, 43]));
        var_dump($classifier->predict([11.7, 44]));
    }

}
