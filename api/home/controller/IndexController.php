<?php
// +----------------------------------------------------------------------
// | ThinkCMF [ WE CAN DO IT MORE SIMPLE ]
// +----------------------------------------------------------------------
// | Copyright (c) 2013-2017 http://www.thinkcmf.com All rights reserved.
// +----------------------------------------------------------------------
// | Author: Dean <zxxjjforever@163.com>
// +----------------------------------------------------------------------
namespace api\home\controller;


use cmf\controller\RestBaseController;
use Phpml\Classification\NaiveBayes;
use Phpml\Classification\SVC;
use Phpml\SupportVectorMachine\Kernel;
use Phpml\ModelManager;

class IndexController extends RestBaseController
{
    // api 首页
    public function index()
    {
        $this->success("恭喜您,API访问成功!", [
            'version' => '1.1.0',
            'doc'     => 'http://www.thinkcmf.com/cmf5api.html'
        ]);
    }

    public function  demo(){
        $samples = [
            [5.4,20],
			[5.1,19],
			[4.8,18],
			[6,23],
			[6.9,26],
			[7.2,27],
			[6.5,24],
			[6.2,23],
			[4.3,16],
			[3,11],
			[5.1,19],
			[6.2,23],
			[7.4,28],
			[8.5,32],
			[8.6,32],
			[9.1,34],
			[8.5,32],
			[8.4,31],
			[7.8,29],
			[6.6,25],
			[7.2,27],
			[7,27],
			[5.4,20],
			[9,34],
			[9.6,36],
			[8.2,31],
			[2.6,10],
			[5.4,20],
			[3.1,12],
			[4,15],
			[4.5,17],
			[6.2,23],
			[3.8,14],
			[5.8,22],
			[11.4,43],
			[7,26],
			[8.2,31],
			[9.3,35],
			[10.5,39],
			[9.9,37],
			[11.1,42],
			[10.3,39],
			[10,37],
			[9.9,37],
			[11.1,42],
			[10.4,39],
			[10.2,38],
			[9.5,36],
			[10.2,38],
			[9.1,34],
			[10.3,39],
			[9.4,35],
			[9.9,37],
			[9.5,36],
			[9,34],
			[8.6,32],
			[9.7,36],
			[6.7,25],
			[6.4,24],
			[6,23],
			[5.2,19],
			[4.3,16],
			[4.1,16],
			[3.2,12],
			[1.8,7],
			[2.6,10],
			[1.6,6],
			[2.5,9],
			[2.5,9],
			[3.7,14],
			[4.4,16],
			[5.8,22],
			[7.1,26],
			[7.5,28],
			[8,30],
			[9.7,36],
			[11.7,44],
			[10.2,38],
			[10.4,39],
			[11.8,44],
			[14,52],
			[11.3,42],
			[13.6,51],
			[18.9,71],
			[12.1,45],
			[13.9,52],
			[12.7,48],
			[13.5,51],
			[13.3,50],
			[17.2,64],
			[13.2,50],
			[11.7,44],
			[13.8,52],
			[12.3,46],
			[12.1,46],
			[9.5,36],
			[12.7,48],
			[11.1,42],
			[8.6,32],
			[9.6,36],
			[10.8,41],
			[8.3,31],
			[9.1,34],
			[6.5,25],
			[6.7,25],
			[5.7,21],
			[4.3,16],
			[6.2,23],
			[5.4,20],
			[3,11],
			[3.3,12],
			[2.1,8],
			[4.3,16],
			[4.6,17],
			[5.8,22],
			[7.8,30],
			[4.9,18],
			[4.6,17],
			[3.2,12],
			[5.8,22],
			[7.2,27],
			[7.2,27],
			[7.3,27],
			[5.7,21],
			[9.7,36],
			[8,30],
			[11.5,43],
			[13.1,49],
			[16,60],
			[14.6,55],
			[16.2,61],
			[19.9,71],
			[20.6,78],
			[19.7,74],
			[19.4,73],
			[19.5,73],
			[22.3,84],
			[20.2,76],
			[19.1,72],
			[15.6,59],
			[19.2,72],
			[20.9,78],
			[21.5,81],
			[20.5,77],
			[21.6,81],
			[15.2,57],
			[22.7,85],
			[19.9,75],
			[15.4,58],
			[16.8,63],
			[18.5,69],
			[13.6,51],
			[18.2,68],
			[18.3,69],
			[14.6,55],
			[13.5,51],
			[10.8,41],
			[16.9,64],
			[17.9,67],
			[14.1,53],
			[11.9,45],
			[12.5,47],
			[9.9,37],
			[10.4,39],
			[11,41],
			[9.7,36],
			[7.5,28],
			[5.9,22],
			[5.6,21],
			[9.9,37],
			[10,37],
			[7.4,28],
			[11.8,44],
			[14.3,54],
			[14.4,54],
			[16.5,62],
			[12.1,45],
			[14.7,55],
			[20.8,78],
			[21.5,81],
			[34.8,131],
			[24.8,93],
			[31.1,117],
			[25.3,95],
			[28.9,109],
			[20.7,78],
			[14.1,53],
			[12.7,48],
			[12,45],
			[9.7,36],
			[7,26],
			[9.2,35],
			[9.8,37],
			[9.5,36],
			[9.8,37],
			[12.1,45],
			[14.7,55],
			[21.6,81],
			[20,75],
			[20.4,76],
			[20.6,77],
			[22.6,85],
			[27.8,104],
			[31.6,119],
			[27.7,104],
			[20.9,78],
			[20.5,77],
			[17.2,64],
			[15.3,57],
			[13.4,50],
			[14.6,55],
			[16,60],
			[16.9,63],
			[20,75],
			[18.3,68],
			[18.1,68],
			[15.3,57],
			[13.9,52],
			[20.9,78],
			[24.4,91],
			[24.8,93],
			[29.1,109],
			[28.5,107],
			[33.5,125],
			[41.9,157],
			[43.2,162],
			[35.2,132],
			[34.9,131],
			[29,109],
			[18.1,68],
			[22.4,84],
			[21.6,81],
			[22,82],
			[50.6,193],
			[45.2,170],
			[35.6,134],
			[26.9,101],
			[26.9,101],
			[25.4,95],
			[21,79],
			[17,64],
			[19.7,74],
			[21.4,81],
			[29.1,109],
			[31.7,119],
			[30.4,114],
			[28.3,106],
			[50.1,188],
			[36,135],
			[34.5,130],
			[34.2,128],
			[31.9,120],
			[28.2,106],
			[23.1,87],
			[23,86],
			[31.1,117],
			[35.3,132],
			[32.2,121],
			[39.9,150],
			[41.1,154],
			[26.4,99],
			[26.1,98],
			[25.5,96],
			[29.3,110],
			[35.5,135],
			[36.2,136],
			[37.1,139],
			[37.6,142],
			[35.8,135],
			[26.8,101],
			[36.5,137],
			[43.3,162],
			[43.1,162],
			[27.9,105],
			[28.9,109],
			[26.4,99],
			[41.1,154],
			[34.9,131],
			[26.4,100],
			[23.9,90],
			[24.5,93],
			[30,113],
			[22.6,85],
			[34,128],
			[25.4,96],
			[49.2,185],
			[47.4,178],
			[19.4,73],
			[28.5,107],
			[22.9,86],
			[25.1,94],
			[30.8,116],
			[39.9,150],
			[34.8,131],
			[32.8,123],
			[31.3,118],
			[35.6,133],
			[37,139],
			[38.7,145],
			[38.8,145],
			[39,146],
			[43.9,165],
			[31.1,117],
			[35,132],
			[24.9,94],
			[50,188],
			[55.4,208],
			[59.2,222],
			[56.6,212],
			[44.7,168],
			[44.9,169],
			[56.6,212],
			[51.8,194],
			[50.6,190],
			[52,195],
			[51.8,194],
			[48.9,183],
			[14.7,55],
			[15.2,57],
			[14.6,55],
			[11.5,43],
			[11.9,45],
			[10.7,40],
			[11.5,43],
			[11.6,43],
			[5.4,20],
			[6.6,25],
			[6.5,25],
			[13.9,52],
			[20.9,78],
			[11.4,43],
			[11.7,44],
			[11.5,43],
			[11.9,45],
			[10.7,40]
		];
        $labels = [
			30,
			30,
			30,
			30,
			30,
			30,
			30,
			30,
			30,
			20,
			30,
			25,
			30,
			30,
			30,
			30,
			30,
			30,
			25,
			25,
			30,
			30,
			30,
			30,
			30,
			30,
			20,
			30,
			20,
			20,
			25,
			30,
			20,
			25,
			30,
			25,
			30,
			30,
			30,
			30,
			30,
			30,
			30,
			30,
			30,
			30,
			30,
			30,
			30,
			30,
			30,
			30,
			30,
			30,
			30,
			30,
			30,
			25,
			25,
			25,
			25,
			25,
			25,
			20,
			15,
			15,
			15,
			20,
			20,
			20,
			20,
			20,
			20,
			25,
			25,
			30,
			30,
			30,
			30,
			30,
			30,
			30,
			30,
			40,
			40,
			30,
			30,
			40,
			30,
			50,
			30,
			30,
			30,
			30,
			40,
			30,
			30,
			30,
			30,
			30,
			30,
			30,
			30,
			25,
			20,
			20,
			20,
			25,
			20,
			20,
			20,
			15,
			20,
			20,
			25,
			30,
			20,
			20,
			20,
			25,
			25,
			25,
			25,
			30,
			30,
			30,
			40,
			40,
			40,
			35,
			40,
			40,
			50,
			50,
			50,
			50,
			60,
			50,
			40,
			40,
			40,
			45,
			50,
			50,
			50,
			40,
			50,
			50,
			40,
			45,
			50,
			30,
			50,
			50,
			40,
			30,
			30,
			40,
			50,
			35,
			30,
			30,
			30,
			30,
			30,
			30,
			25,
			20,
			20,
			30,
			30,
			25,
			35,
			40,
			40,
			50,
			30,
			50,
			80,
			80,
			100,
			100,
			80,
			80,
			90,
			70,
			50,
			50,
			35,
			30,
			30,
			30,
			30,
			30,
			30,
			40,
			50,
			50,
			60,
			60,
			60,
			65,
			80,
			90,
			80,
			70,
			70,
			60,
			50,
			40,
			50,
			50,
			50,
			50,
			50,
			50,
			40,
			40,
			50,
			70,
			70,
			80,
			80,
			100,
			130,
			130,
			110,
			100,
			80,
			40,
			60,
			60,
			60,
			120,
			110,
			100,
			80,
			80,
			80,
			55,
			40,
			50,
			50,
			80,
			90,
			90,
			80,
			130,
			120,
			100,
			100,
			80,
			70,
			60,
			60,
			80,
			90,
			110,
			90,
			100,
			70,
			70,
			60,
			80,
			90,
			90,
			90,
			90,
			90,
			70,
			90,
			120,
			120,
			80,
			100,
			70,
			120,
			90,
			70,
			80,
			80,
			100,
			60,
			90,
			70,
			150,
			150,
			55,
			75,
			60,
			80,
			100,
			130,
			100,
			100,
			100,
			120,
			120,
			120,
			120,
			120,
			130,
			80,
			100,
			70,
			160,
			160,
			180,
			170,
			150,
			150,
			160,
			150,
			150,
			150,
			150,
			150,
			30,
			30,
			30,
			40,
			40,
			40,
			30,
			30,
			30,
			30,
			25,
			40,
			50,
			30,
			30,
			40,
			40,
			40
        ];

        //$classifier = new NaiveBayes();
        $classifier = new SVC(Kernel::LINEAR, $cost=1.0);
        $classifier->train($samples, $labels);
        $filepath = "/home/wwwroot/huoda/model";
        $modelManager = new ModelManager();
        $modelManager->saveToFile($classifier, $filepath);
    }
    
    public function predict(){
        $filepath = "/home/wwwroot/huoda/model";
        $modelManager = new ModelManager();
        $classifier = $modelManager->restoreFromFile($filepath);
        var_dump($classifier->predict([5.4, 20]));
        var_dump($classifier->predict([6.6, 25]));
        var_dump($classifier->predict([6.5, 25]));
        var_dump($classifier->predict([13.9, 52]));
        var_dump($classifier->predict([20.9, 78]));
        var_dump($classifier->predict([11.4, 43]));
        var_dump($classifier->predict([11.7, 44]));
    }

}
